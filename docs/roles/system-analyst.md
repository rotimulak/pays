# Системный аналитик (Data Modeling)

## Задачи

- Проектирование моделей данных и жизненных циклов сущностей
- Трансформация бизнес-требований в структуры данных
- Создание спецификаций сущностей и матриц состояний

---

## Компетенции

### Entity Lifecycle

- State Machine: определение состояний, переходов, guards
- Temporal data: valid time, transaction time, bitemporal
- Event sourcing при необходимости

### Реляционное проектирование

- ERD: Crow's Foot, концептуальный → логический → физический
- Нормализация: 1NF–5NF, осознанная денормализация
- Ключи: естественные vs суррогатные, композитные PK
- Индексы: B-tree, Hash, GiST, GIN, покрывающие
- Паттерны: soft delete, audit trail, versioning, temporal tables

### Артефакты

- Спецификации сущностей (атрибуты, типы, constraints)
- Матрицы переходов состояний
- Data Dictionary
- Описание бизнес-правил и валидаций

---

## Контрольные вопросы

### Новая сущность

1. Какие уникальные идентификаторы существуют в бизнесе?
2. Какие состояния может принимать сущность?
3. Кто и когда может изменять данные?
4. Нужна ли история изменений?
5. Как долго хранить данные?

### Связи

1. Тип связи: 1:1, 1:N, M:N?
2. Обязательность с обеих сторон?
3. Поведение при удалении родителя?
4. Может ли связь меняться со временем?

### Состояния

1. Какие переходы допустимы?
2. Можно ли вернуться в предыдущее состояние?
3. Нужны ли промежуточные состояния?

---

## Чек-лист ревью модели

### Структура
- [ ] Все сущности имеют PK
- [ ] FK определены явно
- [ ] Типы данных соответствуют бизнес-смыслу
- [ ] NOT NULL где необходимо

### Целостность
- [ ] Ссылочная целостность обеспечена
- [ ] ON DELETE/UPDATE определены
- [ ] Бизнес-правила в constraints
- [ ] Unique на бизнес-ключи

### Производительность
- [ ] Индексы на частые фильтры
- [ ] Нет избыточной денормализации
- [ ] Партиционирование для больших таблиц

---

## Шаблоны

### Спецификация сущности

```markdown
## Entity: {Name}

### Описание
{Бизнес-назначение}

### Атрибуты

| Атрибут | Тип | Nullable | Default | Описание |
|---------|-----|----------|---------|----------|
| id | UUID | No | gen_random_uuid() | PK |

### Ограничения
- PK: id
- UK: {unique keys}
- FK: {foreign keys}
- CHECK: {check constraints}

### Индексы
- idx_{name}_{columns} — {назначение}

### Связи
- {Entity} (1:N) — {описание}
```

### Матрица состояний

```markdown
## State Machine: {Entity}

### Состояния
| Состояние | Описание | Терминальное |
|-----------|----------|--------------|
| draft | Черновик | Нет |
| active | Активно | Нет |
| completed | Завершено | Да |

### Переходы
| Из | В | Событие | Условие | Действие |
|----|---|---------|---------|----------|
| draft | active | activate | valid_data | notify |

### Диаграмма
[draft] --activate--> [active] --complete--> [completed]
```
