# Telegram-бот

## Обзор

Telegram-бот — основной интерфейс взаимодействия пользователей с сервисом. Построен на **aiogram 3.x** с полной поддержкой асинхронности.

---

## Команды бота

| Команда | Описание |
|---------|----------|
| `/start` | Регистрация / приветствие |
| `/balance` | Текущий баланс токенов |
| `/subscription` | Статус и срок подписки |
| `/pay` | Создать счёт на оплату |
| `/history` | История платежей |
| `/tariffs` | Доступные тарифы |
| `/help` | Справка по командам |

> Все команды управления скрыты в меню «⚙️ Аккаунт». Отдельно — пункты меню для бизнес-логики сервиса.

---

## Почему aiogram?

- Полностью асинхронный (asyncio native)
- Встроенная FSM для сложных диалогов
- Отличная типизация с Pydantic
- Активное сообщество и быстрые обновления под новый Bot API
- Бесшовная интеграция с FastAPI

Подробное сравнение с альтернативами: [telegram-frameworks-comparison.md](telegram-frameworks-comparison.md)

---

## Структура модуля

```
backend/src/bot/
├── __init__.py
├── handlers/           # Обработчики команд
│   ├── start.py
│   ├── balance.py
│   ├── subscription.py
│   ├── pay.py
│   ├── history.py
│   └── tariffs.py
├── keyboards/          # Inline и reply клавиатуры
├── middlewares/        # Rate limiting, авторизация
├── states/             # FSM состояния
└── utils/              # Вспомогательные функции
```

---

## Rate Limiting

| Endpoint | Лимит | Окно |
|----------|-------|------|
| Команды бота (на пользователя) | 30 запросов | 1 минута |
| `/pay` (создание счёта) | 5 запросов | 1 минута |

---

## Валидация Telegram init_data

При авторизации через Telegram Web App необходимо проверять подлинность данных пользователя. См. [Безопасность](security.md#валидация-telegram-init_data).

---

## Переменные окружения

| Переменная | Описание |
|------------|----------|
| `TELEGRAM_BOT_TOKEN` | Токен бота от @BotFather |
| `WEBHOOK_BASE_URL` | Публичный URL сервера для webhook'ов |

---

## См. также

- [Обзор](overview.md) — общее описание проекта
- [Архитектура](architecture.md) — логика списания токенов
- [Безопасность](security.md) — валидация init_data, rate limiting
