# Promo Codes

> –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ —Å–æ —Å–∫–∏–¥–∫–∞–º–∏ –∏ –±–æ–Ω—É—Å–∞–º–∏ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ —Ç–∞—Ä–∏—Ñ–æ–≤.

## –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

1. –°–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ —Å–∫–∏–¥–æ–∫
2. –ü—Ä–∏–º–µ–Ω—è—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥—ã –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ
3. –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ª–∏–º–∏—Ç—ã –∏ —Å—Ä–æ–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è
4. –£–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏ —á–µ—Ä–µ–∑ CLI

---

## –¢–∏–ø—ã —Å–∫–∏–¥–æ–∫

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----|----------|--------|
| `percent` | –°–∫–∏–¥–∫–∞ N% –æ—Ç —Å—É–º–º—ã | 20% –æ—Ç 500‚ÇΩ = 400‚ÇΩ |
| `fixed` | –°–∫–∏–¥–∫–∞ N —Ä—É–±–ª–µ–π | 100‚ÇΩ –æ—Ç 500‚ÇΩ = 400‚ÇΩ |
| `bonus_tokens` | –ë–æ–Ω—É—Å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã | +50 —Ç–æ–∫–µ–Ω–æ–≤ –∫ –ø–æ–∫—É–ø–∫–µ |

**–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:**

- `percent`: –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ –∫–æ–ø–µ–µ–∫ (19.99% –æ—Ç 100‚ÇΩ = 80.01‚ÇΩ)
- `fixed`: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ 1‚ÇΩ (200‚ÇΩ —Å–∫–∏–¥–∫–∞ –Ω–∞ 150‚ÇΩ = 1‚ÇΩ)
- `bonus_tokens`: —Å—É–º–º–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è, —Ç–æ–∫–µ–Ω—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è

---

## –°—É—â–Ω–æ—Å—Ç–∏

### PromoCode

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `code` | str | –ü—Ä–æ–º–æ–∫–æ–¥ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π, uppercase) |
| `discount_type` | DiscountType | percent, fixed, bonus_tokens |
| `discount_value` | Decimal | –ó–Ω–∞—á–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏ |
| `max_uses` | int \| None | –õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π (null = –±–µ–∑–ª–∏–º–∏—Ç) |
| `uses_count` | int | –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π |
| `valid_from` | datetime | –ù–∞—á–∞–ª–æ –¥–µ–π—Å—Ç–≤–∏—è |
| `valid_until` | datetime \| None | –û–∫–æ–Ω—á–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (null = –±–µ—Å—Å—Ä–æ—á–Ω–æ) |
| `tariff_id` | UUID \| None | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Ç–∞—Ä–∏—Ñ (null = –≤—Å–µ —Ç–∞—Ä–∏—Ñ—ã) |
| `is_active` | bool | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø—Ä–æ–º–æ–∫–æ–¥ |

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**

```
           —Å–æ–∑–¥–∞–Ω–∏–µ
              ‚îÇ
              v
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ Active  ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
             ‚îÇ                ‚îÇ
     deactivate / max_uses    ‚îÇ
             ‚îÇ                ‚îÇ
             v                v
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇInactive ‚îÇ     ‚îÇ Expired  ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –°–µ—Ä–≤–∏—Å—ã

### PromoCodeRepository

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `get_by_code(code)` | –ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É (case-insensitive) |
| `increment_uses(promo_id)` | –ê—Ç–æ–º–∞—Ä–Ω—ã–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç —Å—á—ë—Ç—á–∏–∫–∞ |
| `get_active()` | –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã |
| `is_valid(promo, tariff_id)` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ |
| `can_use(code, tariff_id)` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç –ø—Ä–æ–º–æ–∫–æ–¥–∞ |
| `deactivate(promo_id)` | –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è |

### PromoService

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `validate_promo(code, tariff_id)` | –í–∞–ª–∏–¥–∞—Ü–∏—è —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º |
| `calculate_discount(code, amount, tariff_id)` | –†–∞—Å—á—ë—Ç —Å–∫–∏–¥–∫–∏ |
| `use_promo(promo_id)` | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π |

**DiscountResult:**

```python
@dataclass
class DiscountResult:
    original_amount: Decimal   # 500.00
    final_amount: Decimal      # 400.00
    discount_amount: Decimal   # 100.00
    bonus_tokens: int          # 0
    promo_code: PromoCode
    description: str           # "–°–∫–∏–¥–∫–∞ 20%"
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Invoice

### InvoiceService

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `create_invoice(user_id, tariff_id, promo_code)` | –°–æ–∑–¥–∞–Ω–∏–µ —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º |
| `preview_invoice(user_id, tariff_id, promo_code)` | –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ü–µ–Ω—ã |

**–ê–ª–≥–æ—Ä–∏—Ç–º create_invoice —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º:**

```
1. –ü–æ–ª—É—á–∏—Ç—å —Ç–∞—Ä–∏—Ñ
2. –ï—Å–ª–∏ promo_code —É–∫–∞–∑–∞–Ω:
   - calculate_discount()
   - –ü–æ–ª—É—á–∏—Ç—å final_amount, bonus_tokens
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å promo_code_id –≤ invoice
3. –°–æ–∑–¥–∞—Ç—å invoice —Å:
   - amount = final_amount
   - original_amount = tariff.price
   - tokens = tariff.tokens + bonus_tokens
4. –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å uses_count –ø—Ä–æ–º–æ–∫–æ–¥–∞
```

**–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:**

Idempotency key –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ ‚Äî —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã —Å–æ–∑–¥–∞—é—Ç —Ä–∞–∑–Ω—ã–µ invoices.

---

## Bot Handlers

### FSM States

```python
class PromoStates(StatesGroup):
    waiting_for_code = State()      # –í–≤–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞
    confirming_purchase = State()   # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å –ø—Ä–æ–º–æ
```

### Callbacks

| Callback | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `promo:apply:{tariff_id}` | –ù–∞—á–∞—Ç—å –≤–≤–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞ |
| `promo:skip:{tariff_id}` | –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ –ø—Ä–æ–º–æ–∫–æ–¥–∞ |
| `promo:remove:{tariff_id}` | –£–±—Ä–∞—Ç—å –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–π –ø—Ä–æ–º–æ |
| `promo:confirm:{tariff_id}` | –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–∫—É–ø–∫—É |
| `promo:cancel:{tariff_id}` | –û—Ç–º–µ–Ω–∏—Ç—å –≤–≤–æ–¥ |

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ
2. –ù–∞–∂–∏–º–∞–µ—Ç "üéü –í–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥"
3. –í–≤–æ–¥–∏—Ç –ø—Ä–æ–º–æ–∫–æ–¥ —Ç–µ–∫—Å—Ç–æ–º
4. –ï—Å–ª–∏ –≤–∞–ª–∏–¥–Ω—ã–π:
   ‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ SALE20 –ø—Ä–∏–º–µ–Ω—ë–Ω!
   üí∞ –¶–µ–Ω–∞: 500 ‚ÇΩ ‚Üí 400 ‚ÇΩ
   üéÅ –°–∫–∏–¥–∫–∞ 20%
5. –ù–∞–∂–∏–º–∞–µ—Ç "üí≥ –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ"
6. –°–æ–∑–¥–∞—ë—Ç—Å—è invoice —Å promo_code_id
```

**–°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö:**

| –û—à–∏–±–∫–∞ | –°–æ–æ–±—â–µ–Ω–∏–µ |
|--------|-----------|
| –ù–µ –Ω–∞–π–¥–µ–Ω | –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω |
| –ù–µ–∞–∫—Ç–∏–≤–µ–Ω | –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω |
| –ï—â—ë –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω | –ü—Ä–æ–º–æ–∫–æ–¥ –µ—â—ë –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω |
| –ò—Å—Ç—ë–∫ | –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞ –∏—Å—Ç—ë–∫ |
| –õ–∏–º–∏—Ç | –õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –ø—Ä–æ–º–æ–∫–æ–¥–∞ –∏—Å—á–µ—Ä–ø–∞–Ω |
| –ù–µ –¥–ª—è —Ç–∞—Ä–∏—Ñ–∞ | –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º –∫ —ç—Ç–æ–º—É —Ç–∞—Ä–∏—Ñ—É |

---

## Admin CLI

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `backend/scripts/manage_promos.py`

### –ö–æ–º–∞–Ω–¥—ã

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞
python -m scripts.manage_promos create SALE20 --type percent --value 20
python -m scripts.manage_promos create FIXED100 --type fixed --value 100
python -m scripts.manage_promos create BONUS50 --type bonus_tokens --value 50

# –° –æ–ø—Ü–∏—è–º–∏
python -m scripts.manage_promos create VIP --type percent --value 30 \
    --max-uses 100 \
    --valid-until 2024-12-31 \
    --tariff premium

# –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
python -m scripts.manage_promos list
python -m scripts.manage_promos list --active

# –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞
python -m scripts.manage_promos show SALE20

# –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
python -m scripts.manage_promos deactivate SALE20
```

### –û–ø—Ü–∏–∏ create

| –û–ø—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `--type, -t` | –¢–∏–ø —Å–∫–∏–¥–∫–∏ (percent, fixed, bonus_tokens) |
| `--value, -v` | –ó–Ω–∞—á–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏ |
| `--max-uses, -m` | –õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π |
| `--valid-from` | –ù–∞—á–∞–ª–æ –¥–µ–π—Å—Ç–≤–∏—è (ISO format) |
| `--valid-until` | –û–∫–æ–Ω—á–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è (ISO format) |
| `--tariff` | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Ç–∞—Ä–∏—Ñ (slug) |

---

## –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
backend/src/
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ promo_code.py         # –ú–æ–¥–µ–ª—å PromoCode
‚îÇ   ‚îî‚îÄ‚îÄ repositories/
‚îÇ       ‚îî‚îÄ‚îÄ promo_code_repository.py
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ promo_service.py          # PromoService
‚îÇ   ‚îú‚îÄ‚îÄ invoice_service.py        # –û–±–Ω–æ–≤–ª—ë–Ω –¥–ª—è promo
‚îÇ   ‚îî‚îÄ‚îÄ dto/
‚îÇ       ‚îî‚îÄ‚îÄ promo.py              # PromoCodeDTO, DiscountPreviewDTO
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ states/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ promo.py              # PromoStates FSM
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ promo.py              # Promo handlers
‚îÇ   ‚îú‚îÄ‚îÄ callbacks/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ promo.py              # PromoCallback
‚îÇ   ‚îî‚îÄ‚îÄ keyboards/
‚îÇ       ‚îî‚îÄ‚îÄ promo.py              # Promo keyboards
‚îî‚îÄ‚îÄ scripts/
    ‚îî‚îÄ‚îÄ manage_promos.py          # Admin CLI

migrations/versions/
‚îî‚îÄ‚îÄ 002_add_bonus_tokens_discount_type.py
```

---

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
       –í–≤–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞
              ‚îÇ
              v
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  PromoService     ‚îÇ
    ‚îÇ  .validate_promo()‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             v
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  calculate_       ‚îÇ
    ‚îÇ  discount()       ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
             v
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  InvoiceService   ‚îÇ
    ‚îÇ  .create_invoice()‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
             ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ         ‚îÇ
        v         v
    Invoice    uses_count++
    (—Å promo)
```

---

## DTOs

### PromoCodeDTO

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `id` | UUID | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä |
| `code` | str | –ü—Ä–æ–º–æ–∫–æ–¥ |
| `discount_type` | DiscountType | –¢–∏–ø —Å–∫–∏–¥–∫–∏ |
| `discount_value` | Decimal | –ó–Ω–∞—á–µ–Ω–∏–µ |
| `discount_display` | str | "20%" –∏–ª–∏ "100 ‚ÇΩ" |
| `uses_left` | int \| None | –û—Å—Ç–∞–ª–æ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π |
| `is_valid` | bool | –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å |

### InvoicePreviewDTO

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `tariff_name` | str | –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞ |
| `original_amount` | Decimal | –¶–µ–Ω–∞ –±–µ–∑ —Å–∫–∏–¥–∫–∏ |
| `final_amount` | Decimal | –¶–µ–Ω–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π |
| `discount_info` | str \| None | "–°–∫–∏–¥–∫–∞ 20%" |
| `tokens` | int | –¢–æ–∫–µ–Ω–æ–≤ —Å –±–æ–Ω—É—Å–∞–º–∏ |
| `bonus_tokens` | int | –ë–æ–Ω—É—Å–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ |
| `has_discount` | bool | –ï—Å—Ç—å —Å–∫–∏–¥–∫–∞ –∏–ª–∏ –±–æ–Ω—É—Å |

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **–û—Ç:** [Database](./database.md), [Tariffs](./tariffs.md)
- **–î–ª—è:** [Billing](./billing.md), [Bot](./bot.md)
