# E3.5 ‚Äî Seed Data

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## Tasks

### T3.5.1 ‚Äî Seed tariffs script

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î —Ç–µ—Å—Ç–æ–≤—ã–º–∏ —Ç–∞—Ä–∏—Ñ–∞–º–∏.

**–§–∞–π–ª:** `backend/scripts/seed_tariffs.py`

**–¢–∞—Ä–∏—Ñ—ã:**
```python
SEED_TARIFFS = [
    {
        "slug": "basic",
        "name": "Basic ü•â",
        "description": "–ù–∞—á–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç –¥–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —Å —Å–µ—Ä–≤–∏—Å–æ–º",
        "price": Decimal("99.00"),
        "tokens": 20,
        "subscription_days": 0,
        "sort_order": 1,
        "is_active": True,
    },
    {
        "slug": "standard",
        "name": "Standard ü•à",
        "description": "–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",
        "price": Decimal("249.00"),
        "tokens": 50,
        "subscription_days": 0,
        "sort_order": 2,
        "is_active": True,
    },
    {
        "slug": "premium",
        "name": "Premium üíé",
        "description": "–ú–∞–∫—Å–∏–º—É–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —Å –ø–æ–¥–ø–∏—Å–∫–æ–π",
        "price": Decimal("499.00"),
        "tokens": 100,
        "subscription_days": 30,
        "sort_order": 3,
        "is_active": True,
    },
    {
        "slug": "subscription-only",
        "name": "–ü–æ–¥–ø–∏—Å–∫–∞ üìÖ",
        "description": "–¢–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å–∫–∞ –±–µ–∑ —Ç–æ–∫–µ–Ω–æ–≤",
        "price": Decimal("199.00"),
        "tokens": 0,
        "subscription_days": 30,
        "sort_order": 4,
        "is_active": True,
    },
]
```

**–°–∫—Ä–∏–ø—Ç:**
```python
import asyncio
from uuid import uuid4

from db.session import async_session_factory
from db.models.tariff import Tariff
from db.repositories.tariff_repository import TariffRepository

async def seed_tariffs(force: bool = False) -> None:
    """
    Seed database with test tariffs.

    Args:
        force: If True, recreate tariffs even if they exist
    """
    async with async_session_factory() as session:
        repo = TariffRepository(session)

        for tariff_data in SEED_TARIFFS:
            existing = await repo.get_by_slug(tariff_data["slug"])

            if existing and not force:
                print(f"Tariff '{tariff_data['slug']}' already exists, skipping")
                continue

            if existing and force:
                # Update existing
                for key, value in tariff_data.items():
                    setattr(existing, key, value)
                await session.commit()
                print(f"Updated tariff '{tariff_data['slug']}'")
            else:
                # Create new
                tariff = Tariff(id=uuid4(), **tariff_data)
                session.add(tariff)
                await session.commit()
                print(f"Created tariff '{tariff_data['slug']}'")

    print("Seeding complete!")

if __name__ == "__main__":
    import sys
    force = "--force" in sys.argv
    asyncio.run(seed_tariffs(force=force))
```

**–ó–∞–ø—É—Å–∫:**
```bash
# Create tariffs (skip existing)
python -m scripts.seed_tariffs

# Force recreate
python -m scripts.seed_tariffs --force
```

**DoD:**
- [ ] –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—ë—Ç –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–∞—Ä–∏—Ñ—ã
- [ ] –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã
- [ ] `--force` —Ñ–ª–∞–≥ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
- [ ] –°–∫—Ä–∏–ø—Ç –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–∫ –º–æ–¥—É–ª—å
- [ ] –í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π (created/skipped/updated)
