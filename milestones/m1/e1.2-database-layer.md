# E1.2 — Database Layer

## Описание

Настройка подключения к базе данных: async engine, session factory, настройка Alembic для миграций.

---

## Tasks

### T1.2.1 — Create database session

**Описание:** Создать `db/session.py` с async engine и session factory.

**Файл:** `backend/src/db/session.py`

**Компоненты:**
- `engine` — AsyncEngine с настройками пула
- `async_session_factory` — async_sessionmaker
- `get_session()` — async context manager для получения сессии
- `Base` — декларативная база для моделей

**Настройки пула:**
- `pool_size=5`
- `max_overflow=10`
- `pool_timeout=30`

**DoD:**
- [ ] AsyncEngine создан с правильными настройками
- [ ] Session factory использует async_sessionmaker
- [ ] Context manager корректно коммитит/откатывает
- [ ] Base создан с правильными naming conventions для constraints

---

### T1.2.2 — Setup Alembic

**Описание:** Настроить Alembic для миграций.

**Файлы:**
- `backend/alembic.ini`
- `backend/migrations/env.py`
- `backend/migrations/script.py.mako`
- `backend/migrations/versions/` (пустая директория)

**Требования:**
- Async режим миграций
- Автоимпорт моделей из `db/models/`
- Naming conventions для constraints

**DoD:**
- [ ] `alembic.ini` настроен
- [ ] `env.py` использует async migrations
- [ ] `alembic revision --autogenerate` работает
- [ ] `alembic upgrade head` работает на пустой БД
